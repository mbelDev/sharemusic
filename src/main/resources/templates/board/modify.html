<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="/js/jquery-3.6.3.min.js"></script>
  </head>
  <body>
    <h1>글 수정하기</h1>
    <form action="/board/modify" method="post">
      <div>
        <span>곡 이름</span
        ><input type="text" name="postTitle" th:value="${boardDto.postTitle}" />
      </div>
      <div>
        <span>가수 이름</span
        ><input
          type="text"
          name="postSinger"
          th:value="${boardDto.postSinger}"
        />
      </div>
      <div>
        <span>설명(150자 이내)</span
        ><input type="text" name="postCont" th:value="${boardDto.postCont}" />
      </div>
      <div>
        <span>유튜브 링크</span
        ><input
          type="text"
          name="postLink"
          th:value="'https://youtu.be/' + ${boardDto.postLink}"
          class="postLink"
        />
      </div>
      <div>
        <span>장르</span>
        <select name="postGenre" id="" class="postGenre">
          <option value="락" th:selected="${boardDto.postGenre=='락'}">
            락
          </option>
          <option value="발라드" th:selected="${boardDto.postGenre=='발라드'}">
            발라드
          </option>
          <option value="팝" th:selected="${boardDto.postGenre=='팝'}">
            팝
          </option>
          <option value="재즈" th:selected="${boardDto.postGenre=='재즈'}">
            재즈
          </option>
          <option value="메탈" th:selected="${boardDto.postGenre=='메탈'}">
            메탈
          </option>
          <option value="EDM" th:selected="${boardDto.postGenre=='EDM'}">
            EDM
          </option>
          <option
            value="보컬로이드"
            th:selected="${boardDto.postGenre=='보컬로이드'}"
          >
            보컬로이드
          </option>
          <option
            value="etc"
            th:selected="${#strings.setSplit(boardDto.postGenre, '-')[0]} == 'etc'"
          >
            기타
          </option>
        </select>
        <!-- 기타 선택할 시 나타날 input -->
        <!-- if 장르가 기타일 경우 표시 -->
        <input
          type="text"
          class="genreEtc"
          th:if="${#lists.size(#strings.setSplit(boardDto.postGenre, '-'))} == 1"
          value=""
          name="genreEtc"
        />
        <!-- unless 장르가 기타가 아닐 경우 표시 -->
        <input
          type="text"
          class="genreEtc"
          th:unless="${#lists.size(#strings.setSplit(boardDto.postGenre, '-'))} == 1"
          th:value="${#strings.setSplit(boardDto.postGenre, '-')[1]}"
          name="genreEtc"
        />
      </div>
      <div>
        <span>갬성</span>
        <select name="postEmote" id="" class="postEmote">
          <option value="신남" th:selected="${boardDto.postEmote=='신남'}">
            신남
          </option>
          <option value="우울" th:selected="${boardDto.postEmote=='우울'}">
            우울
          </option>
          <option value="희열" th:selected="${boardDto.postEmote=='희열'}">
            희열
          </option>
          <option value="으스스" th:selected="${boardDto.postEmote=='으스스'}">
            으스스
          </option>
          <option
            value="etc"
            th:selected="${#strings.setSplit(boardDto.postEmote, '-')[0]} == 'etc'"
          >
            기타
          </option>
        </select>
        <!-- 기타 선택할 시 나타날 input -->
        <!-- if 분위기가 기타일 경우 표시 -->
        <input
          type="text"
          class="emoteEtc"
          th:if="${#lists.size(#strings.setSplit(boardDto.postEmote, '-'))} == 1"
          value=""
          name="emoteEtc"
        />
        <!-- unless 장르가 기타가 아닐 경우 표시 -->
        <input
          type="text"
          class="emoteEtc"
          th:unless="${#lists.size(#strings.setSplit(boardDto.postEmote, '-'))} == 1"
          th:value="${#strings.setSplit(boardDto.postEmote, '-')[1]}"
          name="emoteEtc"
        />
      </div>
      <!-- 로그인 한 유저의 이름 보내기 -->
      <!-- <input type="hidden" name="postAuth" value="${session.userNm}"> -->
      <input type="hidden" name="postNo" th:value="${param.postNo}" />
      <button class="btn btn-confirm">수정</button>
    </form>

    <script>
      // 유튜브 링크가 맞는지 확인&링크에서 영상의 id만 뽑아오기
      $(".btn-confirm").on("click", function () {
        const url = $(".postLink").val();
        const regExp =
          "^.*(?:(?:youtu\\.be\\/|v\\/|vi\\/|u\\/\\w\\/|embed\\/)|(?:(?:watch)?\\?v(?:i)?=|\\&v(?:i)?=))([^#\\&\\?]*).*";
        const match = url.match(regExp);

        if (match) {
          const getId = match[1];
          $(".postLink").val(match[1]);
          return true;
        } else {
          // 유튜브 링크를 다시 확인하라고 경고 창
        }
        return false;
      });

      // input 숨겨뒀다가 select에서 기타를 선택할 시 input 보이기
      if ($(".postGenre").val() != "etc") {
        $(".genreEtc").hide();
      }

      $(".postGenre").change(function () {
        if ($(".postGenre").val() == "etc") {
          $(".genreEtc").show();
        } else {
          $(".genreEtc").hide();
        }
      });

      // input 숨겨뒀다가 select에서 기타를 선택할 시 input 보이기
      if ($(".postEmote").val() != "etc") {
        $(".emoteEtc").hide();
      }

      $(".postEmote").change(function () {
        if ($(".postEmote").val() == "etc") {
          $(".emoteEtc").show();
        } else {
          $(".emoteEtc").hide();
        }
      });
    </script>
  </body>
</html>
