<!DOCTYPE html>
<html
  lang="en"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:th="http://www.thymeleaf.org"
  layout:decorate="~{/include/layoutMember.html}">
  <main id="mainPage-Area" class="container" layout:fragment="contents">
    <section class="recent-page">
      <article class="recent-page--listBox">
        <div class="recent-page--list">
          <h4>최근 감상 기록</h4>
          <ul>
            <input class="val-userID" type="hidden" th:value="${loggedUser.userID}">
            <li th:each="item:${historyList}">
              <a th:href="@{/board/view(postNo=${item.postNo})}">
                <div class="recent-listImg--box">
                  <div class="recent-listImg--img">
                    <img th:src="@{${'https://img.youtube.com/vi/' + item.postLink + '/mqdefault.jpg'}}">
                  </div><!-- .recent-listImg--img -->
                  <div class="recent-listImg--content">
                    <input class="val-postNo" type="hidden" th:value="${item.postNo}">
                    <div class="recent-music--title-All">
                      <div class="recent-music--title recent-music--title01">
                        <div>
                          <p th:text="${item.postTitle}">곡 명</p>
                          <p th:text="${item.postSinger}">가수 명</p>
                        </div>
                        <div>
                          <input type="button" class="btn-like" style="display:inline-block; width:15px; height:15px; background:#fff" th:data-userID="${loggedUser.userID}" th:data-postNo="${item.postNo}" th:data-liked="${item.liked}">
                          </input>
                          <input type="button" class="btn-bookmark" style="display:inline-block; width:15px; height:15px; background:#777" th:data-userID="${loggedUser.userID}" th:data-postNo="${item.postNo}" th:data-liked="${item.bookmark}">
                          </input>
                        </div>
                      </div>
                      <div class="recent-music--title recent-music--title02">
                        <p th:text="${item.postAuth}">작성자</p>
                        <p th:text="${item.readDate}">시청일자</p>
                      </div>
                    </div>
                    <div class="liLine"></div>
                  </div><!-- .recent-listImg--content -->
                </div><!-- .recent-listImg--box -->
              </a>
            </li>
            <li th:if="${#lists.isEmpty(historyList)}">
              <div style="display:block; height:200px; width: 600px; border: 1px solid #fff; text-align: center;">
                  <span style="display:block ;color:#fff; font-style: bold; margin-top: 90px;"> 아직 열람하신 곡이 한 곡도 없어요!! </span>
              </div>
          </li>
          </ul>
        </div><!-- .recent-page--list -->
      </article><!-- .recent-page--listBox -->
    </section><!-- .recent-page -->
  <script>
    likeEvent();
    function likeEvent(){
        const btns = document.querySelectorAll(".btn-like");
        btns.forEach((item)=>{
            item.addEventListener("click",(e)=>{
                const sendData = {
                    "postNo":item.dataset.postno,
                    "userID":item.dataset.userid,
                    "liked":item.dataset.liked
                }
                console.log(sendData);
                $.ajax({
                    url:"/member/like",
                    type:"post",
                    data:sendData,
                    success:function(response){
                        console.log(response.result);
                        alert("좋아요!");
                    },
                    error:function(err){
                        console.log(err);
                    }
                })
            })
        })


    }

    

  </script>
  </main>
</html>
